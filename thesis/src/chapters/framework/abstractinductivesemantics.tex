\section{Abstract inductive semantics}

From the theory of abstract interpretation we know that the definition of the
denotational semantics can be modified to work on any complete lattice as long
that we can provide sensible function for the base commands. The rationale
behind is the same as in the denotational semantics but instead representing
collections of states with $\pow{\states}$ now they are represented by an
arbitrary complete lattice.

\begin{definition}[Abstract inductive semantics]

  \label{def:abstract-inductive-semantics}
  Given a complete lattice $A$ and a family of monotone functions $\bsem{b}^A : A
  \to A$ $\forall b \in Base$ the abstract inductive semantics is defined as 
  follows:

  \begin{align*}
      \asem{\cdot}         & \;\;:\; \lang \to A \to A \\
      \asem{\sskip}         &\defeq id \\
      \asem{b}             &\defeq \bsem{b}^A \\
      \asem{C_1 \fcmp C_2} &\defeq \asem{C_2} \circ \asem{C_1} \\
      \asem{C_1 + C_2}     &\defeq \lambda P . \asem{C_1} P \join_A \asem{C_2} P \\
      \asem{C^\fix}        &\defeq \lambda P . \lfp(\lambda P'. P \join_A \asem{C} P')
  \end{align*}
\end{definition}

\begin{theorem}[Monotonicity]
  \label{thm:asem-mono} 
  $\forall \; C \in \lang$ $\asem{C}$ is monotone.
\end{theorem}
\begin{proof}
  We want to prove that $\forall P, Q \in A$ and $C \in \lang$
  $$P \leq_A Q \implies \asem{C}(P) \leq_A \asem{C}(Q)$$
  By structural induction on $C$:
  \begin{itemize}
    \item $\sskip$:
      \begin{align*}
        \sem{\sskip}(P) 
          &= P & \text{By definition of $\asem{\sskip}$}\\
          &\leq Q \\
          &= \sem{\sskip}(Q) & \text{By definition of $\asem{\sskip}$}\\
      \end{align*}

    \item $b$:
      \begin{align*}
        \sem{b}(P) 
          &= \bsem{b}^A(P)
          & \text{By definition of $\asem{b}$}\\
          &\leq \bsem{b}^A(Q)
          & \text{By definition}\\
          &= \sem{b}(Q) & \text{By definition of $\asem{b}$}\\
      \end{align*}

    \item $C_1 \fcmp C_2$:

      By inductive hypothesis $\asem{C_1}$ is monotone hence
      $\asem{C_1}(P) \leq_A \asem{C_1}(Q)$

      \begin{align*}
        \asem{C_1 \fcmp C_2}(P) 
          &= \asem{C_2}(\asem{C_1}(P))
          &\text{By definition of $\asem{C_1 \fcmp C_2}$}\\
          &\leq_A \asem{C_2}(\asem{C_1}(Q))
          &\text{By inductive hypothesis on $\asem{C_2}$} \\
      \end{align*}
  
    \item $C_1 + C_2$:
      \begin{align*}
        \asem{C_1 + C_2}(P) 
          &= \asem{C_1}(P) \join_A \asem{C_2}(P)
          &\text{By definition of $\asem{C_1 + C_2}$}\\
          &\leq_A \asem{C_1}(Q) \join_A \asem{C_2}(P)
          &\text{By inductive hypothesis on $\asem{C_1}$} \\
          &\leq_A \asem{C_1}(Q) \join_A \asem{C_2}(Q)
          &\text{By inductive hypothesis on $\asem{C_2}$} \\
          &= \asem{C_1 + C_2}(Q) 
          &\text{By definition of $\asem{C_1 + C_2}$}\\
      \end{align*}
    
    \item $C^\fix$:

      \begin{align*}
        \asem{C^\fix}(P) 
          &= lfp(\lambda P'. P \join_A \asem{C}(P'))
          &\text{By definition of $\asem{C^\fix}$}\\
          &\leq_A lfp(\lambda P'. Q \join_A \asem{C}(P'))
          &\text{By theorem \ref{thm:lfp-mono}}\\
          &= \asem{C^\fix}(Q) 
          &\text{By definition of $\asem{C^\fix}$}\\
      \end{align*}

  \end{itemize}

\end{proof}


\begin{lemma}[$\sem{\cdot}$ well-defined]
  $\forall \; C \in \lang$ $\asem{C}$ is well-defined.
\end{lemma}
\begin{proof}
  From theorems \ref{thm:asem-mono} and 
  \ref{thm:knaster} all the least fixpoints in the definition of 
  $\asem{C^\fix}$ exists; for all the other commands the semantics is 
  trivially well-defined.
\end{proof}

From now on we will refer to the complete lattice used to define the abstract
inductive semantics as \textit{domain} borrowing the convention from abstract
interpretation.

\begin{observation}
  \label{obs:post}
  When picking as a domain the lattice $\pow{\states}$ and as base commands
  $\bsem{b}^{\pow{\states}}(P) = \{ \bsem{b}(\sigma)\downarrow \; \mid \sigma 
  \in P \}$ will result in obtaining the denotational semantics from the 
  abstract inductive semantics. $\forall \; C \in \lang$ $\forall P \in 
  \pow{\states}$ 
  $$\asem[\pow{\states}]{C}(P) = \sem{C}(P)$$
  This can be easily assessed by comparing the two definitions.
\end{observation}

\begin{observation}
  \label{obs:abstract-fix}
  There are some domains where $\exists \; C \in \lang$ such that
  $\bigvee_{n \in \nat} (\asem{C})^n(P) \neq \lfp(\lambda P'. P \join_A
  \asem{C}(P'))$.
\end{observation}

\subsection{Connection with Abstract Interpretation}

It turns out that the definition of abstract inductive semantics is closely 
related to the one of abstract semantics in \cite{Cousot77}.

\begin{theorem}[Abstract Interpretation Basis]
  \label{thm:sound-ai}
  If $A$ is an abstract domain and $\bsem{\cdot}^A$ is a sound 
  over-approximation of $\bsem{\cdot}$, then $\asem{\cdot}$ is a sound 
  over-approximation of $\sem{\cdot}$.
\end{theorem}

In particular, the definition of abstract inductive semantics, when the 
semantics of the base commands is sound, is equivalent to an abstract semantics.

This connection also allows us to obtain abstract inductive semantics through 
Galois insertion.

\begin{definition}[Abstract Inductive Semantics by Galois Insertion]
  \label{def:aisgi}
  Let $\langle C, \sqsubseteq \rangle \galoiS{\alpha}{\gamma} \langle A, \leq 
  \rangle$ be a Galois insertion, and let $\asem[C]{C}$ be some abstract 
  inductive semantics defined on $C$. Then, the abstract inductive semantics 
  defined on $A$ with $\bsem{b}^A \defeq \alpha \circ \bsem{c}^C \circ \gamma$ is the 
  abstract inductive semantics obtained by the Galois insertion between $C$ and $A$.
\end{definition}

The abstract inductive semantics obtained by Galois insertion between 
$\pow{\states}$ and any domain $A$ corresponds to the best abstract inductive 
semantics on $A$.
